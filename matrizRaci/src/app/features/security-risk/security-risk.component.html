<div class="srm-shell">

  <!-- â”€â”€ NAV BAR DO MÃ“DULO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <nav class="srm-nav">
    <div class="nav-brand">
      <span class="nav-icon">ğŸ›¡ï¸</span>
      <span class="nav-title">Security Risk Management</span>
    </div>
    <div class="nav-tabs">
      <button [class.active]="currentView === 'dashboard'" (click)="goTo('dashboard')">
        ğŸ“Š Dashboard
      </button>
      <button [class.active]="currentView === 'list'" (click)="goTo('list')">
        ğŸ“‹ AnÃ¡lises
        <span class="count-badge">{{ analyses.length }}</span>
      </button>
    </div>
    <button class="btn-new" (click)="openNew()">
      + Nova AnÃ¡lise
    </button>
  </nav>

  <!-- â”€â”€ CONTEÃšDO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <main class="srm-content">

    <!-- DASHBOARD -->
    @if (currentView === 'dashboard') {
      <app-dashboard></app-dashboard>
    }

    <!-- LISTA DE ANÃLISES -->
    @if (currentView === 'list') {
      <div class="list-view">
        <div class="list-header">
          <h2>ğŸ“‹ AnÃ¡lises de SeguranÃ§a</h2>
          <button class="btn-primary" (click)="openNew()">+ Nova AnÃ¡lise</button>
        </div>

        @if (analyses.length === 0) {
          <div class="empty-state">
            <span class="empty-icon">ğŸ”’</span>
            <p>Nenhuma anÃ¡lise cadastrada ainda.</p>
            <button class="btn-primary" (click)="openNew()">Criar primeira anÃ¡lise</button>
          </div>
        }

        <div class="analysis-grid">
          @for (analysis of analyses; track analysis.id) {
            <div class="analysis-card"
                 [class.critical-card]="isCritical(analysis)"
                 [style.border-left-color]="getRiskColor(analysis)">

              <div class="card-header">
                <div class="card-id-area">
                  <span class="card-icon">{{ getRiskIcon(analysis) }}</span>
                  <div>
                    <span class="card-story-id">{{ analysis.userStoryId }}</span>
                    <span class="card-sprint">{{ analysis.sprint }}</span>
                  </div>
                </div>
                @if (analysis.riskAssessment) {
                  <div class="risk-pill" [style.background]="getRiskColor(analysis)">
                    {{ analysis.riskAssessment.riskLevel }} Â· {{ analysis.riskAssessment.riskScore }}/100
                  </div>
                }
              </div>

              <h3 class="card-feature">{{ analysis.featureName }}</h3>
              <p class="card-endpoint">
                <span class="method-badge">{{ analysis.apiSurface.method }}</span>
                {{ analysis.apiSurface.endpoint }}
              </p>

              <div class="card-systems">
                @for (sys of analysis.systemsImpacted; track sys) {
                  <span class="sys-tag">{{ sys }}</span>
                }
              </div>

              <div class="card-stats">
                <span class="stat vuln-stat">âš ï¸ {{ countVulns(analysis) }} vulns</span>
                <span class="stat ok-stat">âœ… {{ countApproved(analysis) }} aprovados</span>
                @if (analysis.hasSecurityDebt) { <span class="stat debt-stat">ğŸ¦ Debt</span> }
                @if (analysis.requiresPentest) { <span class="stat pentest-stat">ğŸ” Pentest</span> }
              </div>

              <div class="card-actions">
                <button class="btn-action primary" (click)="openChecklist(analysis.id)">
                  Ver Checklist
                </button>
                <button class="btn-action" (click)="openEdit(analysis.id)">
                  âœï¸ Editar
                </button>
                <button class="btn-action" (click)="downloadReport(analysis.id, $event)">
                  â¬‡ï¸ JSON
                </button>
                <button class="btn-action danger" (click)="deleteAnalysis(analysis.id, $event)">
                  ğŸ—‘ï¸
                </button>
              </div>
            </div>
          }
        </div>
      </div>
    }

    <!-- FORMULÃRIO DE CRIAÃ‡ÃƒO/EDIÃ‡ÃƒO -->
    @if (currentView === 'form') {
      <app-analysis-form
        [analysisId]="editingAnalysisId"
        (saved)="onFormSaved($event)"
        (canceled)="onFormCanceled()">
      </app-analysis-form>
    }

    <!-- CHECKLIST DETALHADO -->
    @if (currentView === 'checklist' && selectedAnalysisId) {
      <div class="checklist-view">
        <div class="back-bar">
          <button class="btn-back" (click)="goTo('list')">â† Voltar para Lista</button>
        </div>
        <app-checklist [analysisId]="selectedAnalysisId"></app-checklist>
      </div>
    }
  </main>
</div>
